<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Delivery Tracking System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    body { background:#f4f6f9; }
    #map { height: 400px; }
    .login-box { max-width: 420px; margin: 80px auto; }
  </style>
</head>
<body>

<!-- ================= LOGIN PAGE ================= -->
<div id="loginPage" class="login-box">
  <div class="card shadow">
    <div class="card-body">
      <h4 class="text-center mb-3">Static Login</h4>
      <select id="role" class="form-select mb-3">
        <option value="admin">Admin</option>
        <option value="delivery">Delivery Boy</option>
      </select>
      <input type="text" id="username" class="form-control mb-2" placeholder="Username" />
      <input type="password" id="password" class="form-control mb-3" placeholder="Password" />
      <button class="btn btn-primary w-100" onclick="login()">Login</button>
      <p class="text-muted small mt-2">Admin: admin / 1234 | Delivery: rider / 1234</p>
    </div>
  </div>
</div>

<!-- ================= ADMIN DASHBOARD ================= -->
<div id="adminDashboard" class="container mt-4 d-none">
  <h3 class="mb-3">Admin Dashboard</h3>
  <div class="card">
    <div class="card-body">
      <h5>Live Delivery Boy Location</h5>
      <div id="map"></div>
    </div>
  </div>
</div>

<!-- ================= DELIVERY DASHBOARD ================= -->
<div id="deliveryDashboard" class="container mt-4 d-none">
  <h3 class="mb-3">Delivery Boy Dashboard</h3>
  <div class="card">
    <div class="card-body">
      <p>Your live location is being shared with admin.</p>
      <p><strong>Status:</strong> <span id="locationStatus">Waiting...</span></p>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  let map, marker;

  function login() {
    const role = document.getElementById('role').value;
    const user = document.getElementById('username').value;
    const pass = document.getElementById('password').value;

    if (role === 'admin' && user === 'admin' && pass === '1234') {
      showAdmin();
    } else if (role === 'delivery' && user === 'rider' && pass === '1234') {
      showDelivery();
    } else {
      alert('Invalid login');
    }
  }

  function showAdmin() {
    document.getElementById('loginPage').classList.add('d-none');
    document.getElementById('adminDashboard').classList.remove('d-none');
    initMap();
    listenLocation();
  }

  function showDelivery() {
    document.getElementById('loginPage').classList.add('d-none');
    document.getElementById('deliveryDashboard').classList.remove('d-none');
    startSharingLocation();
  }

  // ============ MAP ============
  function initMap() {
    map = L.map('map').setView([28.6139, 77.2090], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    marker = L.marker([28.6139, 77.2090]).addTo(map)
      .bindPopup('Delivery Boy').openPopup();
  }

  // ============ DELIVERY LOCATION SHARE (SIMULATED STORAGE) ============
  function startSharingLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(pos => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;
        localStorage.setItem('deliveryLocation', JSON.stringify({ lat, lng }));
        document.getElementById('locationStatus').innerText = 'Live';
      }, () => {
        alert('Location access denied');
      }, { enableHighAccuracy: true });
    }
  }

  // ============ ADMIN LISTENS LOCATION ============
  function listenLocation() {
    setInterval(() => {
      const data = localStorage.getItem('deliveryLocation');
      if (data) {
        const { lat, lng } = JSON.parse(data);
        marker.setLatLng([lat, lng]);
        map.setView([lat, lng]);
      }
    }, 2000);
  }
</script>

</body>
</html>
